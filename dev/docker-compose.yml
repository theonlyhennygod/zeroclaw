# Development Environment for CrabClaw Agentic Testing
#
# Use this for:
# - Running the agent in a sandboxed environment
# - Testing dangerous commands safely
# - Developing new skills/integrations
#
# Usage:
#   cd dev && ./cli.sh up
#   or from root: ./dev/cli.sh up
name: crabclaw-dev
services:
  # ── The Agent (Development Image) ──
  # Builds from source using the 'dev' stage of the root Dockerfile
  crabclaw-dev:
    build:
      context: ..
      dockerfile: Dockerfile
      target: dev
    container_name: crabclaw-dev
    restart: unless-stopped
    environment:
      - API_KEY
      - PROVIDER
      - ZEROCLAW_MODEL
      - ZEROCLAW_GATEWAY_PORT=3000
      - SANDBOX_HOST=crabclaw-sandbox
    volumes:
      # Mount single config file (avoids shadowing other files in .crabclaw)
      - ../target/.crabclaw/config.toml:/crabclaw-data/.crabclaw/config.toml
      # Mount shared workspace
      - ../playground:/crabclaw-data/workspace
    ports:
      - "127.0.0.1:3000:3000"
    networks:
      - dev-net

  # ── The Sandbox (Ubuntu Environment) ──
  # A fully loaded Ubuntu environment for the agent to play in.
  sandbox:
    build:
      context: sandbox # Context relative to dev/
      dockerfile: Dockerfile
    container_name: crabclaw-sandbox
    hostname: dev-box
    command: ["tail", "-f", "/dev/null"]
    working_dir: /home/developer/workspace
    user: developer
    environment:
      - TERM=xterm-256color
      - SHELL=/bin/bash
    volumes:
      - ../playground:/home/developer/workspace # Mount local playground
    networks:
      - dev-net

networks:
  dev-net:
    driver: bridge
